---
title: "Unity in Diversity: Genetic similarities and differences between regional populations in the 1000 Genomics Project"
editor_options: 
  chunk_output_type: console
---

Humans cluster into populations of genetically similar individuals, but no population is truly unique; all share genetic features with all other populations. Clusters are evident by dark colors along the diagonal of the heatmap.  Shared genetic features with geographically distant populations are evident in coloration in the off-diagonal elements.

```{r, echo = F}
library(reticulate)
#py_install("pandas")
#py_install("polars")
#py_install("seaborn")
```

```{python, echo = F}
#import polars as pl
import pandas as pd
import numpy as np
from great_tables import GT, md, html, style, loc
```

```{python, echo = F}
dist_mat_pd = pd.read_csv("dist_mat_final.csv")
#dist_mat_pl = pl.read_csv("dist_mat_final.csv")
```

```{python, echo = F}
# Define groups for spanners
## AND select anything to be excluded
africa_AFR    = ['ACB',
                 #'ASW','ESN',
                 'GWD','LWK',
                 #'MSL',
                 'YRI'
                 ]
americas_AMR  = ['CLM',
                'MXL','PEL','PUR']
east_asia_EAS = ['CDX',
                #'CHB',
                'CHS',
                'JPT','KHV']
europe_EUR    = [#'CEU',
                'FIN','GBR','IBS',
                 'TSI'
                ]
southasia_SAS = [#'BEB',
               'GIH',
                'ITU','PJL','STU']
                
# combine into single list                
numeric_cols = africa_AFR+americas_AMR+east_asia_EAS+europe_EUR+southasia_SAS

```

```{python, echo = F}
# columns with meta data
meta_cols = ['sup_pop', 
             'oneKG_pop', 
             'location', 
             'location_combo',
             'pop_details', 
             'ethnic_cultural_group',
             'sup_pop_alt', 'icon']
       
# all columns used
cols_use = numeric_cols+meta_cols

# rows used
rows_use = dist_mat_pd.oneKG_pop.isin(numeric_cols)
```

```{python, echo = F}
# make my table
(
    GT(dist_mat_pd.loc[rows_use,cols_use]).tab_style(
        style=style.text(size = "0"),
        locations=loc.body(columns=numeric_cols)
    )
    #.tab_header(title=md("**Unity in Diversity: Genetic similarities and differences between regional populations in the 1000 Genomics Project**"),
    # subtitle="Humans cluster into populations of genetically similar individuals, but no population is truly unique; all share genetic features with all other populations.")
    .cols_hide(columns=[
      "oneKG_pop",
      "location", 
      "pop_details",
      "sup_pop",
      "sup_pop_alt"])
    .fmt_image("icon", path="icons/")
    #.tab_stub(
    #  rowname_col="oneKG_pop", 
    #  groupname_col="sup_pop"
    #)
    .tab_spanner(
        label="Group",
        columns=[
                #"sup_pop", 
                "location_combo",
                #"oneKG_pop",
                "icon"
                ]
    )
    .tab_spanner(
        label="Africa",
        columns=africa_AFR
    )
    .tab_spanner(
        label=html("Americas<sub>1<sub>"),
        columns=americas_AMR
    )
    .tab_spanner(
        label="East Asia",
        columns=east_asia_EAS
    )
    .tab_spanner(
        label="Western Europe",
        columns=europe_EUR
    )
    .tab_spanner(
        label="South Asia",
        columns=southasia_SAS
    )
    .tab_spanner(
        label="Genetic Distances",
        columns=numeric_cols
    )
    #.tab_spanner(
    #    label="Notes",
    #    columns=[
    #             "ethnic_cultural_group"#,
    #             #"country_sampling"
    #             ]
    #)
    .fmt_markdown(columns=["location_combo"])
    .cols_move_to_start(columns=[#"sup_pop", 
                                "location_combo",
                                 "oneKG_pop",
                                "icon"
                                ])

    .cols_label(
        #sup_pop = "Super population",
        oneKG_pop = "Population Code",
        location_combo = "Location",
        #country_sampling = "Sampling location",
        ethnic_cultural_group = md("Ethnic/ <br> Cultural Group"),
        icon = ""
    )
    .cols_align(align="center")
    .fmt_number(columns=numeric_cols, decimals=0, use_seps=False)
    #.sub_zero(zero_text='nil')
    .data_color(
        domain=[90, 0],
        palette=["white", "orange"],
        na_color="white",
    )
    .tab_source_note(source_note=md("**Notes**: 1. Populations in the *Americas* group are characterized by complex ancestry of indigenous peoples, Africans and Europeans due to the history of European colonization and exploitation."))
    .tab_source_note(source_note=md("**Source**: Data for genetic variation around the OCA2 genes was derived from the 1000 Genomes Project (https://www.internationalgenome.org/)."))
    .tab_source_note(source_note=md("**Methods**: Genetic distances between the 2500 individuals in the dataset was determined for the OCA2 gene using Euclidean distance. Color intensity represents distances between the centroids of each population.  Darker colors represent greater similarity"))
    .opt_table_outline()
    .tab_style(
        style=style.borders(sides=["top"], weight='1px', color="black"),
        locations=loc.body(rows=[0,4,8,12,16,20])
    )
    .tab_style(
        style=style.borders(sides=["left"], weight='1px', color="black"),
        locations=loc.body(columns=numeric_cols[0:20:4]),
    )
    .tab_style(
        style=style.borders(sides=["right"], weight='1px', color="black"),
        locations=loc.body(columns=numeric_cols[19]),
    )
    #.tab_options(table_width = "200%")
    #.tab_options(heading_title_font_size = "120%")
    #.tab_options(heading_subtitle_font_size = "120%")
    .tab_options(column_labels_font_size = "100%")
    .tab_options(column_labels_font_weight = "bold")
    .tab_options(column_labels_font_weight = "bold")

    

)
```
